#!/bin/bash
# set -x

[ $# -gt 1 ] || { echo "Use $0 output_file htmls_list" ; exit 127 ; }

out=$1
shift

cat <<EOF > $out
/* $1, automatically generated by $0 */

#include <stdlib.h>
#include "rx-method-http-lwip.h"

EOF

for f in $* ; do
    n=$(basename ${f} .html.o)
    start=_binary_http_files_$(echo $n | sed -e 's/\//_/g')_html_start
    end=_binary_http_files_$(echo $n | sed -e 's/\//_/g')_html_end
    echo "/* file $f */" >> $out
    echo "extern char ${start}[];" >> $out
    echo "extern char ${end}[];" >> $out
    echo -e "declare_http_file_url($n,\n\t$start,\n\t$end,\n\t\"text/html\");" \ >> $out
    echo "" >> $out
done
